- name: cleanup_credit_reservations
  webhook: '{{API_URL}}/jobs/cleanup-reservations'
  schedule: '*/5 * * * *'
  include_in_metadata: true
  payload: {}
  retry_conf:
    num_retries: 3
    retry_interval_seconds: 30
    timeout_seconds: 60
    tolerance_seconds: 300
  headers:
    - name: X-Hasura-Webhook-Secret
      value_from_env: HASURA_WEBHOOK_SECRET
    - name: Content-Type
      value: application/json
  comment: |
    Cleanup expired credit reservations every 5 minutes.
    Finds reservations where status='pending' AND expires_at < NOW(),
    marks them as 'expired', and releases reserved credits.
- name: reset_monthly_credits
  webhook: '{{API_URL}}/jobs/reset-credits'
  schedule: 0 0 * * *
  include_in_metadata: true
  payload: {}
  retry_conf:
    num_retries: 5
    retry_interval_seconds: 300
    timeout_seconds: 300
    tolerance_seconds: 3600
  headers:
    - name: X-Hasura-Webhook-Secret
      value_from_env: HASURA_WEBHOOK_SECRET
    - name: Content-Type
      value: application/json
  comment: |
    Reset monthly credits for organizations at billing period end.
    Runs daily at midnight UTC. For each org where period_end <= NOW():
    - Apply pending plan changes if any
    - Set new billing period (period_end + 1 month)
    - Allocate new monthly credits from plan
    - Keep bonus credits (carry over)
    - Reset reserved credits to 0
    - Create audit transactions
